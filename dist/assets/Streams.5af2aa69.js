import{r as v,R as y,a as u,j as l,p as n,L as O,M as P}from"./index.5179c8da.js";import{c as C,d as k,a as N,e as R,b as j,g as B}from"./lifecycle.d93ed3aa.js";import{i as L}from"./idx.26d2380e.js";const H=r=>{let e=2166136261;for(let t=0,o=r.length;t<o;t++)e^=r.charCodeAt(t),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0},D=r=>{let e=0;return()=>H(`${e++}${r}`)/4294967295},F=r=>{const e=D(r),t=Math.round(e()*360),o=Math.round(e()*80+20),a=Math.round(e()*50+20);return`hsl(${t}, ${o}%, ${a}%)`};var U=function(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return r.addEventListener.apply(r,e)},V=function(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return r.removeEventListener.apply(r,e)},z=["mousedown","touchstart"],G=function(r,e,t){t===void 0&&(t=z);var o=v.exports.useRef(e);v.exports.useEffect(function(){o.current=e},[e]),v.exports.useEffect(function(){for(var a=function(s){var i=r.current;i&&!i.contains(s.target)&&o.current(s)},c=0,d=t;c<d.length;c++){var p=d[c];U(document,p,a)}return function(){for(var s=0,i=t;s<i.length;s++){var m=i[s];V(document,m,a)}}},[t,r])};const J=G;const K=({id:r,channel:e,service:t,overrustle_id:o,afk:a,nsfw:c,promoted:d,hidden:p,modifyStream:s,banViewers:i})=>{const m=y.useRef(),[f,b]=y.useState(!1),x=()=>b(g=>!g);J(m,()=>b(!1));const h=(g,w)=>{s({channel:e,service:t,overrustle_id:o},{[g]:w})};return u("div",{className:"stream-admin-menu-container",ref:m,children:[l("button",{onClick:x,children:"\u2022\u2022\u2022"}),f&&u("div",{className:"stream-admin-menu",children:[u("button",{onClick:()=>h("afk",!a),children:["toggle afk ",a?"off":"on"]}),u("button",{onClick:()=>h("nsfw",!c),children:["toggle nsfw ",c?"off":"on"]}),u("button",{onClick:()=>h("promoted",!d),children:["toggle promoted ",d?"off":"on"]}),u("button",{onClick:()=>h("hidden",!p),children:["toggle hidden ",p?"off":"on"]}),l("button",{onClick:()=>h("removed",!0),children:"remove"}),l("button",{onClick:()=>i(r),children:"ban viewers"})]})]})};const Q=(r,e,t,o)=>{switch(o){case"angelthump":{const a=r&&r!==e?`${r} via ${e}`:e,c=t?`presents ${t}`:"on angelthump";return`${a} ${c}`}case"twitch-vod":return t?`${e}: ${t}`:`${e} on twitch`;case"twitch":return t?`${e} playing ${t}`:`${e} on twitch`;default:return t||`${e} on ${o}`}},M=({id:r,afk_rustlers:e=0,channel:t,live:o=!1,afk:a=!1,nsfw:c=!1,promoted:d=!1,hidden:p=!1,overrustle_id:s,rustlers:i,service:m,thumbnail:f,title:b,isAdmin:x})=>{const h=F(t+m),S=s||`${m}/${t}`,$=Q(s,t,b,m);let g={className:"thumbnail-image thumbnail-default-image"};if(f){const q=Math.floor(Date.now()/(THUMBNAIL_REFRESH_INTERVAL||6e4)),A=o?`${f}?${q}`:f;g={className:`thumbnail-image ${c?"thumbnail-image-nsfw":""}`,style:{backgroundImage:`url(${A})`}}}return u("div",{children:[x&&l(K,{id:r,channel:t,service:m,overrustle_id:s,afk:a,nsfw:c,promoted:d,hidden:p}),u(O,{className:`stream-thumbnail stream-thumbnail-${m}`,title:$,to:S,children:[l("div",{...g}),u("div",{className:"stream-caption",children:[l("span",{className:"thumbnail-text",style:{borderLeftColor:h},children:$}),u("span",{title:e?`${e} afk`:"",className:`badge badge-${o?"success":"danger"}`,children:[i.toLocaleString(),l("span",{className:"glyphicon glyphicon-user"})]})]})]})]})};M.propTypes={id:n.exports.number,afk_rustlers:n.exports.number,channel:n.exports.string.isRequired,live:n.exports.bool,afk:n.exports.bool,nsfw:n.exports.bool,promoted:n.exports.bool,hidden:n.exports.bool,overrustle_id:n.exports.string,rustlers:n.exports.number.isRequired,service:n.exports.string.isRequired,thumbnail:n.exports.string,title:n.exports.string,isAdmin:n.exports.bool};const T=C(N((r,e)=>({isAdmin:L(r,t=>t.self.profile.data.is_admin)}),{fetchProfileIfLoggedIn:R}),k({componentDidMount(){this.props.fetchProfileIfLoggedIn()}}))(M),W=r=>l("article",{children:l(T,{...r})},r.id),I=({header:r,streams:e})=>{const t=e.sort((o,a)=>o.promoted!==a.promoted?o.promoted?-1:1:a.rustlers-o.rustlers).map((o,a)=>l(W,{...o},a));return u("section",{className:"px-3",children:[l("h3",{className:"mt-4",children:r}),l("div",{className:"streams-layout",children:t})]})};I.propTypes={header:n.exports.string.isRequired,streams:n.exports.arrayOf(n.exports.shape({promoted:n.exports.bool,rustlers:n.exports.number}))};const E=({history:r,streams:e,showHiddenStreams:t=!1})=>{var o=Object.values(e);t||(o=o.filter(({hidden:s})=>!s));const a=[{header:"Live Community Streams",test:s=>(Boolean(s.overrustle_id)||s.service==="angelthump")&&s.live&&!s.afk,streams:[]},{header:"Live Streams",test:s=>s.live,streams:[]},{header:"Offline Streams",test:()=>!0,streams:[]}],c=(s,i)=>{const m=s.findIndex(({test:f})=>f(i));return s[m].streams.push(i),s},d=o.reduce(c,a).filter(({streams:s})=>s.length>0).map((s,i)=>l(I,{...s},i)),p=o.reduce((s,i)=>s+i.rustlers,0).toLocaleString();return u(P,{history:r,children:[u("h1",{className:"streams-heading mt-4",children:["See what ",p," rustlers are watching!"]}),l("div",{className:"d-flex flex-column",children:d})]})};E.propTypes={history:n.exports.object,streams:n.exports.objectOf(n.exports.shape({...T.propTypes,id:n.exports.number.isRequired}).isRequired).isRequired,showHiddenStreams:n.exports.bool};const _=C(N(r=>({streams:r.streams,showHiddenStreams:L(r,e=>e.self.profile.data.show_hidden)}),{setStream:j,fetchProfileIfLoggedIn:R,showFooter:B}),k({componentDidMount(){document.title="Strims",this.props.setStream(null),this.props.fetchProfileIfLoggedIn(),this.props.showFooter(!0)}}))(E);export{_ as default};
